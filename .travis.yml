
language: php

sudo: false

cache:
  directories:
    - $HOME/.composer

install:
  - composer install --no-suggest --ansi -n

script:
  - php bin/phpunit -c phpunit.xml
  - php bin/php-cs-fixer fix --config=.php_cs -vvv --dry-run

jobs:
  fast_finish: true
  include:
    - stage: Testing PHP 7.2
      php: 7.2
    - stage: Testing PHP 7.3
      php: 7.3
    - stage: Upload to TER
      if: tag IS present AND env(TYPO3_ORG_USERNAME) IS present AND env(TYPO3_ORG_PASSWORD) IS present
      php: 7.1
      before_install: skip
      install: skip
      before_script: skip
      script:
        - >
          TAG_MESSAGE=$(git tag -n10 -l $TRAVIS_TAG | sed 's/^v*[0-9.]*[ ]*//g');
          composer global require helhum/ter-client;
          $HOME/.composer/vendor/bin/ter-client upload snapshot . -u "$TYPO3_ORG_USERNAME" -p "$TYPO3_ORG_PASSWORD" -m "$TAG_MESSAGE";
